# *CAmpactor*: the General Version

*CAmpactor* is a novel and effective local search algorithm for compacting given pairwise covering arrays into smaller-sized ones. This branch contains the research prototype of the general version of *CAmpactor*, which is able to optimize a $t$-wise covering array (CA) with $2 \le t \le 6$. This branch also has an accompanying *SamplingCA* for generating $t$-wise CAs with $2 \le t \le 6$, which is taken from [the `general` branch of *SamplingCA*](https://github.com/chuanluocs/SamplingCA/tree/general). 

This document serves as a brief operation guide of this generalized version. For the original version, readers may refer to the `master` branch. 

## Instructions for Building *CAmpactor*

```
sh build.sh
```

## Instructions for Running *CAmpactor*

```
./CAmpactor -i [INSTANCE_PATH] --init_CA_path [INITIAL_CA_PATH] -o [OUTPUT_CA_PATH] <optional_parameters> <optional_flags>
```

For the required parameters, we list them as follows. Note that the optimized $t$-wise CA is of the same form as the initial $t$-wise CA constructed by *SamplingCA*. 

| Parameter | Type | Description | 
| - | - | - |
| `-i` | string | path of the input CNF instance |
| `--init_CA_path` | string | path of the initial $t$-wise CA generated by *SamplingCA* |
| `-o` | string | path to which the optimized $t$-wise CA is saved |

For the optional parameters, we list them as follows. 

| Parameter | Type | Default Value | Description | 
| - | - | - | - |
| `--gamma` | integer | 10000 | used to control the termination criterion | 
| `--psi` | float number | 0.1 | used to control the forced patching technique | 
| `--delta` | integer | 10 | used to control the assignment-level forbidden mechanism | 
| `--seed` | integer | 1 | random seed |
| `--twise` | integer | 2 | testing strength |

Note that by setting `--delta` to -1, *CAmpactor* works without assignment-level forbidden mechanism; by setting `--psi` to 0.0, *CAmpactor* works without forced patching technique. 

For the optional flags, we list them as follows. 

| Flag | Description | 
| - | - |
| `--use_cell_tabu` | if set, the assignment-level forbidden mechanism will be replaced with cell-level tabu mechanism |
| `--nosimplcnf` | if set, the input will not be simplified with `bin/coprocessor` |

**Tip:** *CAmpactor* adopts *SamplingCA* as its initialization algorithm. As described in the repository of *SamplingCA*, *SamplingCA* employs a tool named *Coprocessor* to simplify input CNFs. Therefore, in order to conform to *SamplingCA*, by default *CAmpactor* utilizes `bin/coprocessor` to simplify input CNFs as well. The flag `--nosimplcnf` controls this behavior. For issues related with this simplification mechanism, users may find the tip in [SamplingCA/README.md](SamplingCA/README.md) useful. 

## Example Command for Running *CAmpactor*

We provide a bash script `simple_run.sh` for users to run *CAmpactor* in an end-to-end manner. That is, by executing this bash script, users can obtain a $t$-wise CA which is initially constructed by *SamplingCA* and then optimized by *CAmpactor*. 

**Note**: For running *SamplingCA* separately, users may refer to the instructions in [SamplingCA/README.md](SamplingCA/README.md). For running *CAmpactor* separately, users may refer to the instructions in the above section. 

The usage of `simple_run.sh` is as follows. 

```
sh simple_run.sh [RANDOM_SEED] [INSTANCE_PATH] [OUTPUT_CA_NAME] [TESTING_STRENGTH]
```

An example of running `simple_run.sh`: 

```
sh simple_run.sh 1 cnf_benchmarks/linux.cnf linux_3-wise_CA.out 3
```

The command above calls *SamplingCA* to get a 3-wise CA of `cnf_benchmarks/linux.cnf` with default hyper-parameter settings, and then calls *CAmpactor* to optimize the initial 3-wise CA with default hyper-parameter settings. The result is stored in `linux_3-wise_CA.out`. And here both *SamplingCA* and *CAmpactor* uses random seed 1. 

## Implementation of *CAmpactor*

The directory named `src/` includes the implementation of *CAmpactor*. 

## Main Developers

- Qiyuan Zhao (<zqy1018@hotmail.com>)
- Chuan Luo (<chuanluophd@outlook.com>)
